<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>2D Mario Car Obby</title>
    <style>
        body { margin: 0; overflow: hidden; background: #a5d6f7; font-family: sans-serif; }
        canvas { display: block; }
        #hud {
            position: absolute; top: 15px; left: 15px;
            color: white; text-shadow: 2px 2px #000;
            display: flex; flex-direction: column; gap: 8px;
            pointer-events: none;
        }
        .bar-bg { width: 120px; height: 15px; background: #333; border: 2px solid #fff; }
        #gas-level { width: 100%; height: 100%; background: #ffdf00; }
    </style>
</head>
<body>

<div id="hud">
    <div style="font-size: 20px;">TIME LEFT: <span id="timer">0.30</span></div>
    <div>GAS: E <div class="bar-bg" style="display:inline-block; vertical-align:middle;"><div id="gas-level"></div></div> FULL</div>
    <div>COINS: <span id="coin-count">35</span></div>
    <div>LEVEL: 1</div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- Player Settings ---
const car = {
    x: 100, y: 300, w: 80, h: 40,
    vx: 0, vy: 0,
    speed: 0.6, friction: 0.95, gravity: 0.8, jump: -15,
    isGrounded: false, gas: 100, coins: 35
};

// --- Level Layout ---
const platforms = [
    { x: 0, y: 500, w: 500, h: 200, color: '#5a3d2b' }, // Brown ground
    { x: 650, y: 450, w: 400, h: 250, color: '#5a3d2b' }, // Floating island
    { x: 500, y: 600, w: 150, h: 100, color: '#1e90ff', type: 'water' } // Blue water
];

const keys = {};
window.addEventListener('keydown', e => {
    keys[e.code] = true;
    // JUMP TRIGGER
    if (e.code === 'Space' && car.isGrounded) {
        car.vy = car.jump;
        car.isGrounded = false;
    }
});
window.addEventListener('keyup', e => keys[e.code] = false);

function loop() {
    // 1. Move Car
    if (keys['ArrowRight'] && car.gas > 0) { car.vx += car.speed; car.gas -= 0.1; }
    if (keys['ArrowLeft'] && car.gas > 0) { car.vx -= car.speed; car.gas -= 0.1; }
    
    car.vx *= car.friction;
    car.vy += car.gravity;
    car.x += car.vx;
    car.y += car.vy;

    // 2. Platform Collision
    car.isGrounded = false;
    platforms.forEach(p => {
        if (car.x < p.x + p.w && car.x + car.w > p.x &&
            car.y < p.y + p.h && car.y + car.h > p.y) {
            
            if (p.type === 'water') {
                car.x = 100; car.y = 300; car.vx = 0; car.gas = 100; // Reset
            } else if (car.vy > 0) { // Landing
                car.y = p.y - car.h;
                car.vy = 0;
                car.isGrounded = true;
            }
        }
    });

    // 3. Draw Everything
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw Ground
    platforms.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, p.w, p.h);
        if (p.type !== 'water') { // Grass top
            ctx.fillStyle = '#71aa34';
            ctx.fillRect(p.x, p.y, p.w, 15);
        }
    });

    // Draw Realistic 2D Car (Shadows + Detail)
    ctx.fillStyle = '#c0392b'; // Dark Red
    ctx.fillRect(car.x, car.y, car.w, car.h); // Body
    ctx.fillStyle = '#e74c3c'; // Highlight Red
    ctx.fillRect(car.x, car.y, car.w, car.h/2); 
    
    ctx.fillStyle = '#000'; // Wheels
    ctx.beginPath(); ctx.arc(car.x + 15, car.y + car.h, 10, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(car.x + 65, car.y + car.h, 10, 0, Math.PI*2); ctx.fill();

    // 4. Update HUD
    document.getElementById('gas-level').style.width = car.gas + "%";
    document.getElementById('coin-count').innerText = car.coins;

    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
